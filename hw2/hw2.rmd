---
title: Homework 2
author: Zhenhua Wang
output: pdf_document
---

# Problem 1
The objective of this problem is to approximate the CDF of $X$ based on the survival function below.First we solve for $F(x)$ as below,

$$
\begin{align}
F(x) &= 1 - \int_{x-1}^\infty \phi_{\tau}(\epsilon)d\epsilon - \int_{-\infty}^{x-1}\{ \frac{\delta}{2\delta - 1}(x - \epsilon)^{-\frac{1-\delta}{\delta}} - \frac{1 - \delta}{2\delta - 1} (x - \epsilon)^{-1} \}\phi_{\tau}(\epsilon)d\epsilon \\
&= \int_{-\infty}^{x-1} \{1 - \frac{\delta}{2\delta - 1}(x - \epsilon)^{-\frac{1-\delta}{\delta}} + \frac{1 - \delta}{2\delta - 1} (x - \epsilon)^{-1} \}\phi_{\tau}(\epsilon)d\epsilon
\end{align}
$$
We started the problem with defining the integrand as in the above equation in python and intergrating it in python as well. But this failed as we saw jumps in the CDF. Hence we transformed the integral such that the integral is in the finite interval $(0,1]$.

Let $x-\epsilon = \frac{1}{t}$ so that $(-\infty,x-1]$ maps to $(0,1]$. Then the CDF $F(x)$ can be written as below,

$$
\begin{align}
F(x) &= \int_{0}^{1} \Bigg\{1 - \frac{\delta}{2\delta - 1}\Bigg(\frac{1}{t}\Bigg)^{-\frac{1-\delta}{\delta}} + \frac{1 - \delta}{2\delta - 1} \Bigg(\frac{1}{t}\Bigg)^{-1} \Bigg\}\frac{\phi_{\tau}(x-1/t)}{t^2}dt
\end{align}
$$
Then we proceeded to use the three different ways to intergate this function in python and C++ using gsl. Complete code is submitted with the homework. The below figure shows the estimate of the CDF for the two different values of $\delta$ and for different ranges of $X$.
![](q1plot.png){width="70%"}

# Problem 2

The objective of this problem is to obtain a sample from the exponentially tilted positive stable distribution which has the following pdf.
$$
\begin{align*}
f(x; \theta)
&= \sqrt{\frac{1}{4\pi}} \frac{\text{exp}(-\frac{1}{4x} - \theta x)}{x^{3/2} \text{exp}(-\sqrt{\theta})} = \frac{\text{exp}(-\frac{1}{4x} - \theta x +\sqrt{\theta})}{\sqrt{4\pi} x^{3/2}}
\end{align*}
$$
To sample from this distribution we use an exponential distribution with rate 0.09 as our proposal dtsribution which has the pdf $q(x)$ as below.
$$
q(x) = 0.09 e^{-0.09x}
$$

Then we use a rejection sampling technique to obtain the 100000 sample. The first step in the rejection sampling was to determine  $k$, the rejection factor. This was set by obtaining the maximum of the ratio of $f(x)/q(x)$ from a random sample. Based on our proposal distribution we set $k$ as 15.

We were able to replicate figure 3 based on our rejection sampling technique. 
```{r message=FALSE, warning=FALSE}
true_density <- function(x, theta = 0.1) {
  exp(-1/(4*x) - theta*x + sqrt(theta)) / (sqrt(4*pi) * x^(3/2))
}

proposal_density <- function(x) {
  0.09 * exp(-0.09 * x)
}

proposal_quantile <- function(x) {
  -log(1 - x) / 0.09
}

rejection_sampler <- function(N, K, true_dens, prop_dens, prop_quan) {
  res <- matrix(NA, 2, N)
  for (i in 1:N) {
    # Generate variable from proposal distribution
    U <- runif(1)
    exp_var <- prop_quan(U)
    counter <- 1
    # Evaluate ratio
    ratio <- true_dens(exp_var) / (K * prop_dens(exp_var))
    while (runif(1) > ratio) {
      # Generate variable from proposal distribution
      U <- runif(1)
      exp_var <- prop_quan(U)
      counter <- counter + 1
      # Update ratio
      ratio <- true_dens(exp_var) / (K * prop_dens(exp_var))
    }
    res[1, i] <- exp_var
    res[2, i] <- counter
  }
  return(res)
}

## Compute rejection factor K
N <- 100000
x_vec <- seq(1e-5, 60, length.out = N)
true_dens <- true_density(x_vec)
prop_dens <- proposal_density(x_vec)
print(sprintf("sup f(x)/q(x) is approximate to %.3f", max(true_dens / prop_dens)))
K <- 15
## sample
set.seed(5)
res <- rejection_sampler(N, K = K,
  true_dens = true_density,
  prop_dens = proposal_density,
  prop_quan = proposal_quantile)
samples <- res[1, ]
## plot
hist(samples, breaks = 1000, freq = FALSE, border = "lightblue")
curve(true_density, from = 1e-5, to = 60,
  n = 1000, add = TRUE, col = "red", lty = 3)
```

# Problem 3
The objective of this problem is to estimate the probability the diagonal of a matrix $X$ is all 1’s. The probability distribution of the matrix is as follows,

$$\pi(X) \propto  p^{N(X)}(1 − p)^{16−N(X)} exp\{−λD(X)\}.$$

where $N(X)$ is the total number of successes in $X$  and $D(X)$ is the total number of neighbors (horizontal or vertical). 

### (1) Algorithm Description

### (2)

# Problem 4

# Appendix
